<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Marka | Tienda Online</title>
    <style>
        :root {
            --petroleo: #004b57;
            --azul-claro: #007bbd;
            --purpura: #9b3081;
            --rosa: #ef476f;
            --dorado: #d4af37;
            --fondo: #f0f4f5;
            --blanco: #ffffff;
            --verde-wa: #00c853;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--fondo); color: #333; padding-bottom: 120px; }

        /* HEADER & LOGO DIN√ÅMICO */
        header { background: var(--blanco); padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo-img { max-width: 150px; height: auto; margin-bottom: 10px; display: none; margin-left: auto; margin-right: auto; }
        .puntos-decorativos { display: flex; justify-content: center; gap: 8px; margin-top: 10px; }
        .punto { width: 12px; height: 12px; border-radius: 50%; }

        /* BANNER SUPERIOR NEGRO */
        .top-delivery-bar { background: #003038; color: white; padding: 10px; text-align: center; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 10px; }

        .contenedor { max-width: 800px; margin: 0 auto; padding: 15px; }

        /* BUSCADOR */
        .search-container { position: relative; margin: 20px 0; }
        #buscador { width: 100%; padding: 12px 45px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; outline: none; }
        .search-icon { position: absolute; left: 15px; top: 12px; color: #888; }

        /* BANNER PROMOCIONAL (IMAGEN REFERENCIA) */
        .promo-banner {
            background: linear-gradient(135deg, #006d77 0%, #00b4d8 100%);
            border-radius: 15px;
            padding: 30px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        .promo-banner h2 { margin: 0; font-size: 1.8rem; font-weight: 800; }
        .promo-banner p { margin: 5px 0 0; opacity: 0.9; }
        .promo-icon { width: 100px; filter: brightness(0) invert(1); opacity: 0.9; }

        /* CATEGOR√çAS */
        .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
        .btn-cat { background: white; border: 1px solid #ddd; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; color: #555; }
        .btn-cat.activo { background: var(--petroleo); color: white; border-color: var(--petroleo); }

        /* GRID DE PRODUCTOS */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 160px; object-fit: cover; background: #fafafa; }
        .badge-hoy { position: absolute; top: 10px; right: 10px; background: var(--petroleo); color: white; font-size: 0.6rem; font-weight: bold; padding: 4px 8px; border-radius: 20px; }
        
        .card-body { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-name { font-size: 0.85rem; font-weight: 600; color: #444; margin-bottom: 5px; }
        .card-ver { color: #888; font-size: 0.75rem; cursor: pointer; text-decoration: underline; margin-bottom: 10px; display: block; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; }
        .card-price { font-weight: 800; font-size: 1.1rem; color: #222; }
        .btn-add { background: var(--petroleo); color: white; border: none; padding: 8px 15px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; cursor: pointer; }

        /* MODALES */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 400px; border-radius: 20px; padding: 25px; position: relative; }

        /* BARRA INFERIOR DE CARRITO (EXACTA A LA IMAGEN) */
        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .cart-info { display: flex; align-items: center; gap: 15px; font-size: 1.2rem; }
        .btn-revisar { background: var(--verde-wa); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; }

        /* FOOTER INFO */
        .info-footer { background: #003038; color: white; padding: 30px 20px; text-align: center; font-size: 0.8rem; line-height: 1.6; }
        .info-footer a { color: #4cc9f0; text-decoration: none; }

        @media (min-width: 600px) { .grid { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>
<body>

<header>
    <img id="logo-dinamico" src="" class="logo-img" alt="Logo">
    <div class="puntos-decorativos">
        <div class="punto" style="background:var(--petroleo)"></div>
        <div class="punto" style="background:var(--azul-claro)"></div>
        <div class="punto" style="background:var(--purpura)"></div>
        <div class="punto" style="background:var(--rosa)"></div>
        <div class="punto" style="background:var(--dorado)"></div>
    </div>
</header>

<div class="top-delivery-bar">
    <span>üõµ Delivery disponible (Costo seg√∫n destino)</span>
</div>

<div class="contenedor">
    <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" id="buscador" placeholder="Search" oninput="filtrar()">
    </div>

    <div class="promo-banner">
        <div>
            <h2>Delivery Activo üõµ</h2>
            <p>Recibe tu pedido en la puerta de tu casa hoy mismo.</p>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/679/679720.png" class="promo-icon" alt="Paquete">
    </div>

    <h3>Categor√≠as</h3>
    <div class="cat-scroll" id="cat-bar">
        <button class="btn-cat activo" onclick="cambiarCat('todos', this)">Todos</button>
    </div>

    <div id="loader" style="text-align:center; padding:50px;">Cargando experiencia...</div>
    <div class="grid" id="grid-productos"></div>
</div>

<div id="modalFicha" class="modal" onclick="cerrar()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <img id="f-img" style="width:100%; border-radius:10px; margin-bottom:15px;">
        <h2 id="f-nombre" style="margin:0; color:var(--petroleo)"></h2>
        <p id="f-desc" style="color:#666; margin:15px 0"></p>
        <div style="font-size:1.5rem; font-weight:900; margin-bottom:20px;" id="f-precio"></div>
        <button class="btn-revisar" style="width:100%" id="f-btn-add">A√±adir al carrito</button>
    </div>
</div>

<div class="footer-bar">
    <div class="cart-info">
        <span style="font-size: 2rem;">üõí</span>
        <div>
            <b id="cart-count">0 Items</b><br>
            <span id="cart-total" style="font-weight: 900;">$0.00</span>
        </div>
    </div>
    <button class="btn-revisar" onclick="enviarWA()">Revisar Carrito</button>
</div>

<div class="info-footer">
    <p id="footer-dir">...</p>
    <a id="footer-map" target="_blank">üìç Ver ubicaci√≥n en Google Maps</a>
</div>

<script>
    // ENLACES DE TU GOOGLE SHEETS
    const SHEETS_PRODUCTOS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdjQeudLeSccCORPmrQSFjuC826ZE7Mm7pgxRQ99RBmfcMw9Xb6QmRETG--HavNoe_xGX2QtPtOfC7/pub?gid=0&single=true&output=csv';
    const SHEETS_CONFIG = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdjQeudLeSccCORPmrQSFjuC826ZE7Mm7pgxRQ99RBmfcMw9Xb6QmRETG--HavNoe_xGX2QtPtOfC7/pub?gid=283577687&single=true&output=csv';

    let productos = [], carrito = [], config = {};
    let catSel = 'todos';

    async function init() {
        try {
            // Cargar Configuraci√≥n (Logo, Tel√©fono, Direcci√≥n)
            const respConf = await fetch(SHEETS_CONFIG);
            const dataConf = await respConf.text();
            dataConf.split(/\r?\n/).forEach(fila => {
                const [llave, valor] = fila.split(',');
                if(llave && valor) {
                    let k = llave.toLowerCase().trim();
                    let v = valor.trim().replace(/^"|"$/g, '');
                    if(k.includes('logo')) {
                        const img = document.getElementById('logo-dinamico');
                        img.src = v;
                        img.style.display = 'block';
                    }
                    if(k.includes('tel')) config.telefono = v.replace(/\s+/g, '');
                    if(k.includes('dir')) document.getElementById('footer-dir').innerText = v;
                    if(k.includes('map')) document.getElementById('footer-map').href = v;
                }
            });

            // Cargar Productos
            const respProd = await fetch(SHEETS_PRODUCTOS);
            const dataProd = await respProd.text();
            productos = dataProd.split(/\r?\n/).slice(1).map(fila => {
                const c = fila.split(',');
                return { id:c[0], nombre:c[1], precio:parseFloat(c[2])||0, cat:c[3]?.toLowerCase().trim(), hoy:c[6]?.toLowerCase().trim()==='si', img:c[5], desc:c[7] };
            }).filter(p => p.nombre);

            // Generar Categor√≠as din√°micas
            const cats = [...new Set(productos.map(p => p.cat))].filter(Boolean);
            cats.forEach(c => {
                const btn = document.createElement('button');
                btn.className = 'btn-cat';
                btn.innerText = c.charAt(0).toUpperCase() + c.slice(1);
                btn.onclick = (e) => cambiarCat(c, e.target);
                document.getElementById('cat-bar').appendChild(btn);
            });

            document.getElementById('loader').style.display = 'none';
            render(productos);
        } catch (e) { console.error("Error cargando datos:", e); }
    }

    function render(lista) {
        const grid = document.getElementById('grid-productos');
        grid.innerHTML = '';
        lista.forEach(p => {
            grid.innerHTML += `
                <div class="card">
                    ${p.hoy ? '<div class="badge-hoy">HOY</div>' : ''}
                    <img src="${p.img}" alt="${p.nombre}" loading="lazy">
                    <div class="card-body">
                        <div>
                            <div class="card-name">${p.nombre}</div>
                            <span class="card-ver" onclick="verDetalle('${p.id}')">Ver detalles</span>
                        </div>
                        <div class="card-footer">
                            <div class="card-price">$${p.precio.toFixed(2)}</div>
                            <button class="btn-add" onclick="agregar('${p.id}')">A√±adir</button>
                        </div>
                    </div>
                </div>`;
        });
    }

    window.verDetalle = (id) => {
        const p = productos.find(x => x.id == id);
        document.getElementById('f-img').src = p.img;
        document.getElementById('f-nombre').innerText = p.nombre;
        document.getElementById('f-desc').innerText = p.desc || "Calidad y estilo garantizado.";
        document.getElementById('f-precio').innerText = `$${p.precio.toFixed(2)}`;
        document.getElementById('f-btn-add').onclick = () => { agregar(id); cerrar(); };
        document.getElementById('modalFicha').style.display = 'flex';
    };

    window.agregar = (id) => {
        const p = productos.find(x => x.id == id);
        carrito.push(p);
        actualizarCarrito();
    };

    function actualizarCarrito() {
        const total = carrito.reduce((sum, p) => sum + p.precio, 0);
        document.getElementById('cart-count').innerText = `${carrito.length} Items`;
        document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
    }

    function enviarWA() {
        if(carrito.length === 0) return alert("El carrito est√° vac√≠o");
        const total = carrito.reduce((sum, p) => sum + p.precio, 0);
        const lista = carrito.map((p, i) => `${i+1}. *${p.nombre}* ($${p.precio.toFixed(2)})`).join('%0A');
        const msg = `*NUEVO PEDIDO*%0A--------------------------%0A${lista}%0A%0A*TOTAL: $${total.toFixed(2)}*%0A--------------------------%0Aüìç Acordar pago y entrega por aqu√≠.`;
        window.open(`https://wa.me/${config.telefono}?text=${msg}`, '_blank');
    }

    window.cerrar = () => document.getElementById('modalFicha').style.display = 'none';

    window.cambiarCat = (c, btn) => {
        document.querySelectorAll('.btn-cat').forEach(b => b.classList.remove('activo'));
        btn.classList.add('activo');
        catSel = c;
        filtrar();
    };

    window.filtrar = () => {
        const busqueda = document.getElementById('buscador').value.toLowerCase();
        const filtrados = productos.filter(p => 
            p.nombre.toLowerCase().includes(busqueda) && (catSel === 'todos' || p.cat === catSel)
        );
        render(filtrados);
    };

    init();
</script>
</body>
</html>
