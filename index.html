<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Marka | Tienda Oficial</title>
    <style>
        :root {
            --petroleo: #0979f7;
            --purpura: #9b3081;
            --azul-claro: #007bbd;
            --fondo: #f8fafb;
            --blanco: #ffffff;
            --verde-wa: #25D366;
            --texto: #2c3e50;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--fondo); color: var(--texto); padding-bottom: 100px; line-height: 1.4; }

        /* HEADER */
        header { background: var(--blanco); padding: 1.2rem; text-align: center; border-bottom: 3px solid var(--petroleo); position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .logo-texto { font-size: 1.7rem; font-weight: 900; color: var(--petroleo); margin: 0; letter-spacing: -1px; text-transform: uppercase; }
        .sub-logo { font-size: 0.7rem; color: var(--azul-claro); font-weight: bold; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 4px; }
        .puntos-decorativos { display: flex; justify-content: center; gap: 6px; margin-top: 6px; }
        .punto { width: 10px; height: 10px; border-radius: 50%; }
        .p-1 { background: var(--petroleo); }
        .p-2 { background: var(--purpura); }
        .p-3 { background: var(--azul-claro); }
        
        /* Estilo para el logo din√°mico */
        .logo-img { 
            max-width: 150px; 
            height: auto; 
            margin: 0 auto 10px; 
            display: none; /* Se activar√° solo si hay un link en Sheets */
        }

        .contenedor { max-width: 900px; margin: 0 auto; padding: 15px; }

        /* BUSCADOR */
        .search-box { position: relative; margin: 15px 0; }
        #buscador { width: 100%; padding: 14px 45px; border-radius: 15px; border: 2px solid #edf2f7; background: white; font-size: 1rem; transition: 0.3s; box-shadow: 0 2px 6px rgba(0,0,0,0.02); }
        #buscador:focus { border-color: var(--azul-claro); box-shadow: 0 0 0 3px rgba(0,123,189,0.1); }
        .search-icon { position: absolute; left: 15px; top: 14px; opacity: 0.4; }

        /* CATEGOR√çAS */
        .categorias { 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; /* Esto permite que bajen a la siguiente fila */
            padding: 5px 0 15px 0; 
        }

        /* Botones normales con borde resaltado */
        .btn-cat { 
            background: white; 
            color: var(--petroleo); 
            border: 2px solid var(--petroleo); /* Borde m√°s grueso y con tu color principal */
            padding: 8px 18px; 
            border-radius: 20px; 
            font-weight: 700; 
            white-space: nowrap; 
            cursor: pointer; 
            font-size: 0.85rem;
            flex-grow: 1;
            max-width: fit-content;
            transition: all 0.3s ease; /* Para que el cambio de color sea suave */
        }

        /* Bot√≥n SELECCIONADO (Color diferente al resto) */
        .btn-cat.activo { 
            background: var(--purpura); /* Cambia aqu√≠ el color del bot√≥n activo */
            color: white; 
            border-color: var(--purpura); 
            box-shadow: 0 4px 10px rgba(155, 48, 129, 0.3); /* Sombra para que resalte */
        }

        /* GRID PRODUCTOS */
        .galeria { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (min-width: 600px) { .galeria { grid-template-columns: repeat(3, 1fr); } }

        .producto { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #f0f0f0; display: flex; flex-direction: column; transition: transform 0.2s; position: relative; }
        .producto img { width: 100%; height: 150px; object-fit: cover; background: #fafafa; }
        
        .btn-share { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.9); border: none; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .badge-oferta { position: absolute; top: 8px; left: 8px; background: var(--purpura); color: white; font-size: 0.6rem; font-weight: 800; padding: 3px 8px; border-radius: 5px; text-transform: uppercase; }

        .p-info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; text-align: center; }
        .p-nombre { font-size: 0.85rem; font-weight: 700; color: #334155; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.4em; }
        .btn-ver { color: var(--azul-claro); font-size: 0.75rem; font-weight: bold; cursor: pointer; margin-bottom: 10px; display: inline-block; }
        .precio { color: var(--petroleo); font-weight: 800; font-size: 1.1rem; margin-bottom: 10px; }
        .btn-add { background: var(--petroleo); color: white; border: none; padding: 10px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.85rem; }

        /* MODALES */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 450px; border-radius: 20px; padding: 25px; max-height: 90vh; overflow-y: auto; position: relative; animation: pop 0.3s ease; }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .ficha-img { width: 100%; height: 200px; object-fit: contain; border-radius: 12px; background: #f8fafb; margin-bottom: 15px; }
        .ficha-desc { background: #f1f5f9; padding: 15px; border-radius: 10px; font-size: 0.9rem; color: #475569; margin: 15px 0; border-left: 4px solid var(--purpura); text-align: left; }

        /* SELECTOR CANTIDAD */
        .cant-box { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 15px 0; }
        .btn-c { width: 36px; height: 36px; border-radius: 50%; border: 1px solid #ddd; background: white; font-weight: bold; cursor: pointer; }

        /* BARRA INFERIOR */
        .footer-cart { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -4px 15px rgba(0,0,0,0.08); z-index: 1100; }
        .cart-stats { display: flex; flex-direction: column; }
        .btn-main { background: var(--verde-wa); color: white; padding: 12px 25px; border-radius: 25px; border: none; font-weight: 800; cursor: pointer; display: none; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.2); }

        /* CARRITO LISTA */
        .item-c { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f5f9; }
        .btn-del { color: #ef4444; border: none; background: none; font-weight: bold; cursor: pointer; padding: 5px; }

        .btn-opcion { display: block; width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; text-align: left; font-weight: bold; cursor: pointer; background: white; transition: 0.2s; }
        .btn-opcion:active { border-color: var(--azul-claro); background: #f0f9ff; }

        .seccion-final { background: var(--petroleo); color: white; padding: 30px 20px; margin-top: 30px; text-align: center; border-radius: 20px 20px 0 0; }
    </style>
</head>
<body>

<header>
    <img id="logo-dinamico" src="" class="logo-img" alt="Logo">
    <div class="sub-logo">Premium Collection</div>
    <div class="logo-texto">TU MARKA</div>
    <div class="puntos-decorativos">
        <div class="punto p-1"></div>
        <div class="punto p-2"></div>
        <div class="punto p-3"></div>
    </div>
</header>

<div class="contenedor">
    <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" id="buscador" placeholder="¬øQu√© est√°s buscando?" oninput="filtrar()">
    </div>

    <div class="categorias" id="cat-bar">
        <button class="btn-cat activo" onclick="cambiarCat('todos', this)">Todos</button>
    </div>

    <div id="loader" style="text-align:center; padding:80px; font-weight:bold; color:var(--petroleo);">Abriendo cat√°logo...</div>
    <div class="galeria" id="grid"></div>
</div>

<div id="modalFicha" class="modal" onclick="cerrar()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <img id="m-img" class="ficha-img">
        <h2 id="m-nombre" style="margin:0; font-size:1.3rem;"></h2>
        <div id="m-desc" class="ficha-desc"></div>
        <div id="m-precio" style="font-size:1.5rem; font-weight:900; color:var(--azul-claro);"></div>
        
        <div class="cant-box">
            <button class="btn-c" onclick="cambiarCant(-1)">-</button>
            <span id="m-cant" style="font-size:1.4rem; font-weight:900;">1</span>
            <button class="btn-c" onclick="cambiarCant(1)">+</button>
        </div>
        
        <button id="m-btn-add" class="btn-add" style="padding:15px; font-size:1rem;">üõí Agregar al Carrito</button>
        <button onclick="cerrar()" style="background:none; border:none; color:#94a3b8; width:100%; margin-top:15px; font-weight:bold; cursor:pointer;">Cerrar</button>
    </div>
</div>

<div id="modalCarrito" class="modal" onclick="cerrar()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="text-align:center; margin-top:0;">Tu Pedido</h2>
        <div id="c-lista"></div>
        <div id="c-total" style="text-align:right; font-size:1.4rem; font-weight:900; padding:20px 0; color:var(--purpura);"></div>
        
        <div id="flujo-pago">
            <p style="font-weight:bold; margin-bottom:5px;">1. ¬øC√≥mo recibes tu compra?</p>
            <button class="btn-opcion" onclick="selEntrega('Retiro en Tienda')">üè¨ Retiro en Tienda</button>
            <button class="btn-opcion" onclick="abrirDelivery()">üõµ Solicitar Delivery</button>
            <input type="text" id="dir-val" placeholder="Direcci√≥n exacta para el delivery..." style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; display:none; margin-top:5px;">
            
            <div id="cierre-final" style="display:none; margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                <p style="font-weight:bold; color:var(--verde-wa);">2. Acuerdo de Pago</p>
                <p style="font-size:0.85rem; color:#64748b; margin-bottom:15px;">Al enviar el pedido, acordaremos los datos de pago m√≥vil o transferencia directamente por WhatsApp.</p>
                <button class="btn-add" style="background:var(--verde-wa); font-size:1rem; padding:15px;" onclick="enviarWA()">üöÄ Enviar Pedido por WhatsApp</button>
            </div>
        </div>
    </div>
</div>

<div class="footer-cart">
    <div class="cart-stats" onclick="abrirCarrito()">
        <span style="font-size:0.85rem; font-weight:bold; color:#64748b;"><span id="n-items">0</span> productos</span>
        <span id="f-total" style="font-size:1.2rem; font-weight:900; color:var(--petroleo);">$0.00</span>
    </div>
    <button id="btn-pedir" class="btn-main" onclick="abrirCarrito()">Revisar Carrito</button>
</div>

<div class="seccion-final">
    <p id="f-dir" style="font-size:0.9rem;">...</p>
    <a id="f-map" style="color:white; font-weight:bold; text-decoration:underline;" target="_blank">Ver en Google Maps</a>
    <p style="font-size:0.8rem; margin-top:20px; opacity:0.6;">Tu Marka &copy; 2026 - Todos los derechos reservados</p>
</div>

<script>
    const HOJA_PROD = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdjQeudLeSccCORPmrQSFjuC826ZE7Mm7pgxRQ99RBmfcMw9Xb6QmRETG--HavNoe_xGX2QtPtOfC7/pub?gid=0&single=true&output=csv';
    const HOJA_CONF = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdjQeudLeSccCORPmrQSFjuC826ZE7Mm7pgxRQ99RBmfcMw9Xb6QmRETG--HavNoe_xGX2QtPtOfC7/pub?gid=283577687&single=true&output=csv';

    let DB = [], CART = [], CONFIG = {tel:'', dir:'', map:''};
    let catActual = 'todos', cantM = 1, prodM = null, entregaM = '';

    async function cargar() {
        try {
            const rC = await fetch(HOJA_CONF);
            const dC = await rC.text();
            dC.split(/\r?\n/).forEach(fila => {
                const [k, v] = fila.split(',');
                if(k && v){
                    let clave = k.toLowerCase().trim();
                    let valor = v.trim().replace(/^"|"$/g, '');
                    if(clave.includes("tel")) CONFIG.tel = valor.replace(/\s+/g, '');
                    if(clave.includes("dir")) CONFIG.dir = valor;
                    if(clave.includes("map")) CONFIG.map = valor;
                    if(clave.includes("logo")) {
                        const img = document.getElementById('logo-dinamico');
                        img.src = valor;
                        img.style.display = 'block';
                    }
                }
            });
            document.getElementById('f-dir').innerText = CONFIG.dir;
            document.getElementById('f-map').href = CONFIG.map;

            const rP = await fetch(HOJA_PROD);
            const dP = await rP.text();
            DB = dP.split(/\r?\n/).slice(1).map(f => {
                const c = f.split(',');
                return { id:c[0], nombre:c[1], precio:parseFloat(c[2])||0, cat:c[3]?.toLowerCase().trim(), oferta:c[4]?.toLowerCase().trim()==='si', img:c[5], desc:c[7] };
            }).filter(p => p.nombre);

            [...new Set(DB.map(p => p.cat))].forEach(c => {
                if(!c) return;
                let b = document.createElement('button');
                b.className = 'btn-cat';
                b.innerText = c.charAt(0).toUpperCase() + c.slice(1);
                b.onclick = (e) => filtrarCat(c, e.target);
                document.getElementById('cat-bar').appendChild(b);
            });

            document.getElementById('loader').style.display = 'none';
            mostrar(DB);
        } catch (e) { console.error(e); }
    }

    function mostrar(lista) {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        lista.forEach(p => {
            g.innerHTML += `
                <div class="producto">
                    <button class="btn-share" onclick="compartir('${p.nombre}')">üîó</button>
                    ${p.oferta ? '<div class="badge-oferta">Oferta</div>' : ''}
                    <img src="${p.img}" loading="lazy">
                    <div class="p-info">
                        <div class="p-nombre">${p.nombre}</div>
                        <div class="btn-ver" onclick="abrirFicha('${p.id}')">Ver detalles</div>
                        <div class="precio">$${p.precio.toFixed(2)}</div>
                        <button class="btn-add" onclick="addSimple('${p.id}')">A√±adir</button>
                    </div>
                </div>`;
        });
    }

    window.abrirFicha = (id) => {
        prodM = DB.find(x => x.id == id);
        cantM = 1;
        document.getElementById('m-cant').innerText = 1;
        document.getElementById('m-img').src = prodM.img;
        document.getElementById('m-nombre').innerText = prodM.nombre;
        document.getElementById('m-desc').innerText = prodM.desc || "Sin descripci√≥n disponible.";
        document.getElementById('m-precio').innerText = `$${prodM.precio.toFixed(2)}`;
        document.getElementById('m-btn-add').onclick = () => addCompleto();
        document.getElementById('modalFicha').style.display = 'flex';
    };

    window.cambiarCant = (v) => { cantM = Math.max(1, cantM + v); document.getElementById('m-cant').innerText = cantM; };

    function addSimple(id) {
        let p = DB.find(x => x.id == id);
        CART.push({ ...p, cant: 1, tid: Date.now()+Math.random() });
        actualizar();
    }

    function addCompleto() {
        CART.push({ ...prodM, cant: cantM, tid: Date.now()+Math.random() });
        cerrar();
        actualizar();
    }

    function actualizar() {
        let total = 0, items = 0;
        const l = document.getElementById('c-lista');
        l.innerHTML = '';
        CART.forEach(i => {
            total += (i.precio * i.cant);
            items += i.cant;
            l.innerHTML += `
                <div class="item-c">
                    <span><b>${i.cant}x</b> ${i.nombre}</span>
                    <span>$${(i.precio*i.cant).toFixed(2)} <button class="btn-del" onclick="borrar('${i.tid}')">‚úï</button></span>
                </div>`;
        });
        document.getElementById('n-items').innerText = items;
        document.getElementById('f-total').innerText = `$${total.toFixed(2)}`;
        document.getElementById('c-total').innerText = `Total: $${total.toFixed(2)}`;
        document.getElementById('btn-pedir').style.display = items > 0 ? 'block' : 'none';
    }

    window.borrar = (tid) => { CART = CART.filter(x => x.tid != tid); actualizar(); if(CART.length === 0) cerrar(); };

    window.cerrar = () => {
        document.querySelectorAll('.modal').forEach(m => m.style.display='none');
        document.getElementById('dir-val').style.display = 'none';
        document.getElementById('cierre-final').style.display = 'none';
    };

    window.abrirCarrito = () => { if(CART.length > 0) document.getElementById('modalCarrito').style.display='flex'; };

    window.selEntrega = (m) => { entregaM = m; document.getElementById('cierre-final').style.display = 'block'; document.getElementById('dir-val').style.display = 'none'; };
    window.abrirDelivery = () => { entregaM = 'Delivery'; document.getElementById('dir-val').style.display = 'block'; document.getElementById('cierre-final').style.display = 'block'; };

    function enviarWA() {
        let dir = document.getElementById('dir-val').value;
        if(entregaM === 'Delivery' && !dir) return alert("Ingresa tu direcci√≥n");

        let t = 0;
        let pStr = CART.map((i, idx) => {
            t += (i.precio * i.cant);
            return `${idx+1}. *${i.nombre}* (x${i.cant}) - $${(i.precio*i.cant).toFixed(2)}`;
        }).join('%0A');

        let m = `*PEDIDO TU MARKA*%0A--------------------------%0A${pStr}%0A%0A*TOTAL A PAGAR: $${t.toFixed(2)}*%0A--------------------------%0Aüìç *Entrega:* ${entregaM}`;
        if(entregaM === 'Delivery') m += `%0Aüè† *Direcci√≥n:* ${encodeURIComponent(dir)}`;
        m += `%0A%0A_Quedo atento a los datos para realizar el pago._`;

        window.open(`https://wa.me/${CONFIG.tel}?text=${m}`, '_blank');
        cerrar();
    }

    window.filtrarCat = (c, b) => {
        document.querySelectorAll('.btn-cat').forEach(x => x.classList.remove('activo'));
        b.classList.add('activo');
        catActual = c;
        filtrar();
    };

    window.filtrar = () => {
        let v = document.getElementById('buscador').value.toLowerCase();
        let f = DB.filter(p => p.nombre.toLowerCase().includes(v) && (catActual === 'todos' || p.cat === catActual));
        mostrar(f);
    };

    window.compartir = (n) => { if(navigator.share) navigator.share({title:'Tu Marka', text:`¬°Mira esto: ${n}!`, url:window.location.href}); };

    cargar();
</script>
</body>
</html>
